<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
  <div class="row">
    <!-- Cart Section -->
    <div class="col-md-4 order-md-2 mb-4">
      <h4 class="d-flex justify-content-between align-items-center mb-3">
        <span class="text-primary">Your Cart</span>
        <span class="badge bg-primary rounded-pill" id="cart-count">0</span>
      </h4>
      <ul class="list-group mb-3" id="cart-list">
        <!-- Items will be injected dynamically -->
      </ul>
      <h5 class="text-end">Total: $<span id="total">0</span></h5>
    </div>

    <!-- Checkout Form -->
    <div class="col-md-8 order-md-1">
      <h4 class="mb-3">Billing Details</h4>
     <form id="checkout-form" method="POST" class="needs-validation" novalidate>
  {% csrf_token %}
  <input type="hidden" id="items" name="items">
  <input type="hidden" id="total-input" name="total">

  <div class="row">
    <div class="col-md-6 mb-3">
      <label for="firstName">First Name</label>
      <input type="text" class="form-control" id="firstName" name="first_name" placeholder="John" required>
    </div>
    <div class="col-md-6 mb-3">
      <label for="lastName">Last Name</label>
      <input type="text" class="form-control" id="lastName" name="last_name" placeholder="Doe" required>
    </div>
  </div>

  <div class="mb-3">
    <label for="email">Email <span class="text-muted">(Required)</span></label>
    <input type="email" class="form-control" id="email" name="email" placeholder="you@example.com" required>
  </div>

  <div class="mb-3">
    <label for="address">Address</label>
    <input type="text" class="form-control" id="address" name="address" placeholder="1234 Main St" required>
  </div>

  <div class="mb-3">
    <label for="address2">Address 2 <span class="text-muted">(Optional)</span></label>
    <input type="text" class="form-control" id="address2" name="address2" placeholder="Apartment or suite">
  </div>

  <div class="row">
    <div class="col-md-5 mb-3">
      <label for="city">City</label>
      <input type="text" class="form-control" id="city" name="city" required>
    </div>
    <div class="col-md-4 mb-3">
      <label for="state">State</label>
      <input type="text" class="form-control" id="state" name="state" required>
    </div>
    <div class="col-md-3 mb-3">
      <label for="zip">Zip</label>
      <input type="text" class="form-control" id="zip" name="zip_code" required>
    </div>
  </div>

  <hr class="mb-4">
  <button class="btn btn-primary btn-lg btn-block w-100" type="submit">Place Order</button>
</form>

    </div>
  </div>
</div>

<script>
  // Load cart from localStorage
  let cart = JSON.parse(localStorage.getItem('cart')) || {};
  let cartList = document.getElementById("cart-list");
  let total = 0;

  for (let id in cart) {
    let quantity = cart[id][0];
    let name  = cart[id][1];
    let price = cart[id][2];
    total += price;

    let itemHTML = `
      <li class="list-group-item d-flex justify-content-between align-items-center">
        ${name}
        <span>${quantity}</span>
        <span>$${price}</span>
      </li>
    `;
    cartList.innerHTML += itemHTML;
  }

  document.getElementById("total").innerText = total;
  document.getElementById("cart-count").innerText = Object.keys(cart).length;

  // Form submission
 document.getElementById("checkout-form").addEventListener("submit", function () {
    document.getElementById("items").value = JSON.stringify(cart);
    document.getElementById("total-input").value = total;
});


</script>

</body>
</html>
